---
title: "MCPツール棚卸しによるClaude Codeのコンテキスト最適化"
url: "https://zenn.dev/medley/articles/optimizing-claude-code-context-with-mcp-tool-audit"
date: 2025-10-10
tags: [readitlater, web-clip, claude-code, mcp, context-management, optimization]
---

# MCPツール棚卸しによるClaude Codeのコンテキスト最適化

**🔗 URL**: [MCPツール棚卸しによるClaude Codeのコンテキスト最適化](https://zenn.dev/medley/articles/optimizing-claude-code-context-with-mcp-tool-audit)  
**📅 Date**: 2025-10-10

## 📄 Original Content

Model Context Protocol（MCP）ツールを多数追加することでClaude Codeの応答精度が低下する現象を分析し、コンテキスト最適化により大幅な改善を実現した実践記事。メドレー社のエンジニアが、MCPツールがコンテキストの約30%を占めていた環境において、使用頻度の低いツールを削除することでFree spaceを27.2%拡大した事例を詳細に解説。Anthropicのエンジニアリングブログが指摘する「コンテキストは有限なリソース」という原則に基づき、/contextコマンドによる可視化、原因分析、対策実施、効率的運用方法までを体系的に紹介。

## 🎯 Summary

- **コンテキスト圧迫の可視化**: /contextコマンドで判明したMCPツールによる60.5k tokens（30.3%）の消費が、Free spaceを38.3%まで圧迫していた実態を定量的に把握
- **根本原因の特定**: SentryおよびCircleCIのMCPツールが67個のツール定義で大量トークンを消費するも、実際の使用頻度が低く「attention budget」を無駄に消費していたことを発見
- **劇的な改善効果**: 使用頻度の低いMCPツール削除により、コンテキスト使用量を62%から35%へ27%削減、Free spaceを65.5%まで拡大し、長期対話とファイル読み込みの同時実行が可能に
- **3つの効率的運用手法**: タスク単位での追加・削除、必要に応じた無効化、定期的な使用量確認という段階的アプローチで柔軟なリソース管理を実現
- **context rotの予防**: 不必要な情報によるモデルの注意力分散と性能劣化を防ぎ、AIエージェントのパフォーマンスを最大化する運用指針を提示

## 📊 コンテキスト使用量の改善結果

| 項目 | 改善前 | 改善後 | 変化量 |
|---|---|---|---|
| MCP tools 使用量 | 60.5k tokens (30.3%) | 6.3k tokens (3.2%) | -54.2k tokens (-27.1%) |
| 全体使用量 | 124k tokens (62%) | 69k tokens (35%) | -55k tokens (-27%) |
| Free space | 77k tokens (38.3%) | 131k tokens (65.5%) | +54k tokens (+27.2%) |

## 📊 削除したMCPツールのトークン消費

| MCP | ツール数 | 主な用途 | 使用頻度 |
|---|---|---|---|
| Sentry | 31個 | エラー監視・トラッキング | 低 |
| CircleCI | 36個 | CI/CDパイプライン管理 | 低 |

## 📊 MCP運用方法の比較

| 運用方法 | 適用シーン | メリット | 実装 |
|---|---|---|---|
| **タスク単位追加・削除** | 特定タスクのみ使用 | 平常時のコンテキスト消費ゼロ | `claude add/remove mcp <server>` |
| **一時無効化** | 頻繁使用だが特定時不要 | 設定保持、再有効化が容易 | `/mcp` → Disable選択 |
| **定期確認** | 常時 | 早期問題発見、予防的管理 | `/context`コマンド定期実行 |

## 📊 無効化時のコンテキスト比較

| 状態 | MCP tools使用量 | Free space | 全体使用量 |
|---|---|---|---|
| 改善前（有効） | 60.5k (30.3%) | 77k (38.3%) | 124k (62%) |
| 無効化後 | 21.9k (11.0%) | 115k (57.4%) | 85k (43%) |
| 削除後 | 6.3k (3.2%) | 131k (65.5%) | 69k (35%) |

## 📊 コンテキスト構成要素の内訳

| 要素 | トークン数 | 割合 | 説明 |
|---|---|---|---|
| System prompt | 2.3k | 1.1% | Claude Codeの基本指示 |
| System tools | 12.5k | 6.3% | 標準ツール定義 |
| MCP tools | 6.3k | 3.2% | 外部連携ツール（改善後） |
| Custom agents | 415 | 0.2% | カスタムエージェント |
| Memory files | 2.8k | 1.4% | 記憶ファイル |
| Messages | 8 | 0.0% | 対話履歴 |
| Free space | 131k | 65.5% | 利用可能領域 |
| Autocompact buffer | 45.0k | 22.5% | 自動圧縮バッファ |

## 💭 My Notes

- 品質保証エンジニアの視点では、テストツール連携（Sentry、CircleCI等）が「設定したものの使わない」状態になりやすく、定期的な棚卸しの重要性を再認識
- /contextコマンドによる可視化は、データ解析における特徴量重要度確認と類似のアプローチで、リソース効率化の基本原則として有効
- Python開発環境でも同様の概念が適用可能：Jupyterカーネルのメモリ管理、import文の最適化、不要ライブラリの削除など
- 子供のClaude Code学習においても、最初から多機能MCPを入れず、必要に応じて段階的に追加する教育アプローチが効果的
- メカトロニクス製品のテスト自動化でも、テストフレームワークのプラグイン管理に同じ原則を適用すべき：使用頻度の低いプラグインがテスト実行時間を肥大化させる可能性

## ⭐ Rating
Important: ⭐⭐⭐⭐⭐

---